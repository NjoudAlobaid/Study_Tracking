<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ | Ø¯Ø­ÙˆÙ… ÙˆØ±ÙŠÙ…ÙŠ - GitHub Storage</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Tajawal:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --dahoum-main: #0077b6; 
            --dahoum-light: #00b4d8;
            --dahoum-grad: linear-gradient(135deg, #0077b6, #00b4d8, #48cae4);
            --remy-main: #6a1b9a; 
            --remy-light: #9c27b0;
            --remy-grad: linear-gradient(135deg, #6a1b9a, #9c27b0, #ba68c8);
            --bg: #f0f4f8;
            --gold: #FFD700;
            --success: #4caf50;
            --error: #f44336;
            --warning: #ff9800;
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background: var(--bg); 
            transition: 0.3s; 
            padding-bottom: 50px; 
            min-height: 100vh;
        }
        
        body.dahoum-theme { 
            --active: var(--dahoum-main); 
            --active-grad: var(--dahoum-grad);
            --active-light: var(--dahoum-light);
        }
        
        body.remy-theme { 
            --active: var(--remy-main); 
            --active-grad: var(--remy-grad);
            --active-light: var(--remy-light);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255,255,255,0.3);
            border-top: 8px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 1.5rem;
            margin-top: 20px;
            font-weight: 700;
        }

        .loading-error {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            margin: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .loading-error h3 {
            color: var(--error);
            margin-bottom: 15px;
        }

        .loading-error p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Navigation */
        .app-bar { 
            background: white; 
            padding: 15px 5%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            border-bottom: 4px solid var(--active); 
        }
        
        .app-logo {
            font-weight: 900;
            font-size: 1.4rem;
            background: var(--active-grad);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn { 
            padding: 10px 25px; 
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            font-weight: bold; 
            font-family: 'Cairo'; 
            transition: 0.3s; 
            color: white; 
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-dahoum { background: var(--dahoum-grad); }
        .btn-remy { background: var(--remy-grad); }
        .btn-admin { background: #455a64; font-size: 0.85rem; }
        .btn-setup { background: var(--warning); font-size: 0.85rem; }

        .container { 
            max-width: 1400px; 
            margin: 30px auto; 
            padding: 0 20px; 
        }

        /* Hero Card */
        .hero-card { 
            background: var(--active-grad); 
            color: white; 
            border-radius: 35px; 
            padding: 40px; 
            text-align: center; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.15); 
            margin-bottom: 30px; 
            position: relative;
            overflow: hidden;
        }

        .hero-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 15s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }
        
        .profile-wrap { 
            position: relative; 
            width: 150px; 
            height: 150px; 
            margin: 0 auto 20px;
            z-index: 1;
        }
        
        .profile-img { 
            width: 100%; 
            height: 100%; 
            border-radius: 50%; 
            border: 6px solid white; 
            object-fit: cover;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .profile-img:hover {
            transform: scale(1.05);
        }
        
        .upload-btn { 
            position: absolute; 
            bottom: 5px; 
            right: 5px; 
            background: white; 
            border-radius: 50%; 
            width: 45px; 
            height: 45px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            color: var(--active); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            font-size: 1.3rem;
        }

        .upload-btn:hover {
            transform: scale(1.15);
        }
        
        .stats-row { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-top: 25px; 
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        
        .stat-item { 
            background: rgba(255,255,255,0.25); 
            backdrop-filter: blur(10px); 
            padding: 15px 30px; 
            border-radius: 25px; 
            min-width: 140px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-val { 
            font-size: 2rem; 
            font-weight: 900; 
            display: block; 
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.95;
        }

        /* Badges */
        .badges-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .badge {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            transition: all 0.3s ease;
            position: relative;
            border: 3px solid transparent;
        }

        .badge.earned {
            background: rgba(255,255,255,0.4);
            border-color: rgba(255,255,255,0.6);
            transform: scale(1.1);
            animation: badgeGlow 2s infinite;
        }

        .badge.locked {
            opacity: 0.25;
            filter: grayscale(100%);
        }

        @keyframes badgeGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(255,255,255,0.4); }
            50% { box-shadow: 0 0 25px rgba(255,255,255,0.7); }
        }

        /* Sync Status */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 0.9rem;
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        .sync-status.show {
            opacity: 1;
            transform: translateY(0);
        }

        .sync-status.success { background: var(--success); }
        .sync-status.error { background: var(--error); }
        .sync-status.syncing { background: #2196F3; }

        /* Quiz Section */
        .quiz-container { 
            background: white; 
            border-radius: 30px; 
            padding: 35px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.08); 
            margin-bottom: 30px; 
            text-align: center; 
            border: 3px solid var(--active); 
        }
        
        .math-text { 
            font-family: 'Tajawal', sans-serif; 
            font-size: 4rem; 
            font-weight: 800; 
            color: var(--active); 
            margin: 25px 0; 
        }
        
        .math-input { 
            font-size: 2.5rem; 
            width: 180px; 
            text-align: center; 
            border: 3px solid #e0e0e0; 
            border-radius: 20px; 
            padding: 12px; 
            font-family: 'Cairo'; 
            transition: all 0.3s ease;
        }

        .math-input:focus {
            outline: none;
            border-color: var(--active);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            transform: scale(1.05);
        }
        
        .feedback-box { 
            margin-top: 25px; 
            font-weight: bold; 
            font-size: 1.4rem; 
            min-height: 50px; 
            border-radius: 20px; 
            padding: 15px; 
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .correct { 
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724; 
            border: 3px solid #28a745; 
        }
        
        .wrong { 
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24; 
            border: 3px solid #dc3545; 
        }

        /* Section Headers */
        .section-header { 
            font-size: 2rem; 
            color: var(--active); 
            margin: 50px 0 25px; 
            display: flex; 
            align-items: center; 
            gap: 15px;
            font-weight: 800;
        }

        .section-icon {
            font-size: 2.5rem;
        }
        
        /* Zoom Cards */
        .zoom-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 25px; 
        }
        
        .zoom-card { 
            background: white; 
            padding: 28px; 
            border-radius: 25px; 
            border-right: 8px solid #2d8cff; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.06); 
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .zoom-card::before {
            content: 'ğŸ“¹';
            position: absolute;
            top: -25px;
            left: -25px;
            font-size: 10rem;
            opacity: 0.04;
        }

        .zoom-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(45, 140, 255, 0.2);
        }

        .zoom-card strong {
            font-size: 1.4rem;
            color: #2d8cff;
            display: block;
            margin-bottom: 12px;
        }
        
        .zoom-btn { 
            display: block; 
            background: linear-gradient(135deg, #2d8cff, #4a9eff); 
            color: white; 
            text-decoration: none; 
            text-align: center; 
            padding: 14px; 
            border-radius: 18px; 
            margin-top: 18px; 
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 5px 18px rgba(45, 140, 255, 0.3);
        }

        .zoom-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(45, 140, 255, 0.5);
        }
        
        /* School Table */
        .table-wrap { 
            background: white; 
            border-radius: 25px; 
            overflow-x: auto; 
            box-shadow: 0 10px 35px rgba(0,0,0,0.08); 
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 800px; 
        }
        
        th, td { 
            padding: 18px; 
            text-align: center; 
            border: 1px solid #f5f5f5; 
        }
        
        th { 
            background: var(--active); 
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .day-cell { 
            background: linear-gradient(135deg, #f8fafc, #e9ecef); 
            font-weight: 900; 
            color: var(--active);
            font-size: 1.1rem;
        }

        /* Journal */
        .week-picker { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin-bottom: 30px; 
            flex-wrap: wrap;
        }
        
        .week-btn { 
            padding: 12px 28px; 
            border-radius: 25px; 
            border: 3px solid var(--active); 
            cursor: pointer; 
            font-weight: 700; 
            background: white; 
            color: var(--active); 
            font-family: 'Cairo';
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .week-btn.active { 
            background: var(--active); 
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .week-btn:hover:not(.active) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .journal-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); 
            gap: 25px; 
        }
        
        .day-card { 
            background: white; 
            padding: 28px; 
            border-radius: 25px; 
            border-top: 8px solid var(--active);
            box-shadow: 0 8px 25px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
        }

        .day-card h3 {
            color: var(--active);
            font-size: 1.6rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .day-card label {
            display: block;
            font-weight: 700;
            margin: 18px 0 10px 0;
            color: #333;
            font-size: 1.05rem;
        }
        
        textarea { 
            width: 100%; 
            padding: 15px; 
            border-radius: 15px; 
            border: 2px solid #e0e0e0; 
            font-family: 'Cairo'; 
            resize: vertical; 
            transition: all 0.3s ease;
            font-size: 1rem;
            min-height: 90px;
            background: #fafafa;
        }

        textarea:focus {
            outline: none;
            border-color: var(--active);
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.08);
        }

        /* Modal */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.7); 
            backdrop-filter: blur(15px); 
            z-index: 3000; 
            align-items: center; 
            justify-content: center; 
        }

        .modal.active {
            display: flex;
        }
        
        .modal-content { 
            background: white; 
            width: 90%; 
            max-width: 550px; 
            padding: 40px; 
            border-radius: 30px; 
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: scale(0.9) translateY(-30px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-content h3 {
            text-align: center;
            color: var(--active);
            font-size: 2rem;
            margin-bottom: 25px;
        }
        
        .modal-input { 
            width: 100%; 
            padding: 14px; 
            margin: 12px 0; 
            border-radius: 15px; 
            border: 2px solid #e0e0e0; 
            font-family: 'Cairo'; 
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--active);
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        .info-box {
            background: #e3f2fd;
            border-right: 4px solid #2196F3;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
        }

        .info-box p {
            color: #1976d2;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .warning-box {
            background: #fff3e0;
            border-right: 4px solid #ff9800;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
        }

        .warning-box p {
            color: #e65100;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .hidden { display: none !important; }

        /* Responsive */
        @media (max-width: 768px) {
            .math-text { font-size: 2.8rem; }
            .math-input { font-size: 2rem; width: 150px; }
            .hero-card { padding: 30px 20px; }
            .profile-wrap { width: 120px; height: 120px; }
            .app-bar { 
                flex-direction: column; 
                gap: 12px; 
                padding: 15px;
            }
            .section-header { 
                font-size: 1.6rem;
                margin: 35px 0 20px;
            }
            .container { padding: 0 15px; }
            .zoom-grid, .journal-grid { grid-template-columns: 1fr; }
            .stat-item {
                min-width: 110px;
                padding: 12px 20px;
            }
            .stat-val { font-size: 1.6rem; }
        }
    </style>
</head>
<body class="dahoum-theme" id="appBody">

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>

    <!-- Sync Status Toast -->
    <div id="syncStatus" class="sync-status">
        <span id="syncIcon">â˜ï¸</span>
        <span id="syncText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...</span>
    </div>

    <!-- App Bar -->
    <div class="app-bar">
        <div class="app-logo">ğŸŒŸ Ù…Ù†ØµØ© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</div>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn btn-dahoum" onclick="switchUser('dahoum')" aria-label="Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø¯Ø­ÙˆÙ…">
                Ø¯Ø­ÙˆÙ… ğŸ‘¦
            </button>
            <button class="btn btn-remy" onclick="switchUser('remy')" aria-label="Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø±ÙŠÙ…ÙŠ">
                Ø±ÙŠÙ…ÙŠ ğŸ‘§
            </button>
            <button class="btn btn-admin" onclick="openAdmin()" aria-label="ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">
                âš™ï¸ Ø¥Ø¯Ø§Ø±Ø©
            </button>
            <button class="btn btn-setup" onclick="openSetup()" aria-label="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub" id="setupBtn">
                âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯
            </button>
        </div>
    </div>

    <div class="container" id="mainContent">
        <!-- Hero Stats -->
        <div class="hero-card">
            <div class="profile-wrap">
                <img id="uImg" class="profile-img" src="https://via.placeholder.com/150/0077b6/ffffff?text=ğŸ‘¦" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©">
                <label class="upload-btn" onclick="document.getElementById('fileInp').click()" aria-label="ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©">
                    ğŸ“·
                </label>
                <input type="file" id="fileInp" class="hidden" accept="image/*" onchange="uploadImg(event)">
            </div>
            <h1 id="uWelcome">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø§Ù„Ø¨Ø·Ù„ Ø¯Ø­ÙˆÙ…!</h1>
            <div class="stats-row">
                <div class="stat-item">
                    <span class="stat-val" id="uStars">0</span>
                    <span class="stat-label">Ø§Ù„Ù†Ø¬ÙˆÙ… â­</span>
                </div>
                <div class="stat-item">
                    <span class="stat-val" id="uPts">0</span>
                    <span class="stat-label">Ø§Ù„Ù†Ù‚Ø§Ø· ğŸ¯</span>
                </div>
                <div class="stat-item">
                    <span class="stat-val" id="uLvl">1</span>
                    <span class="stat-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ğŸ†</span>
                </div>
            </div>
            <div class="badges-row" id="badgesArea"></div>
        </div>

        <!-- Math Challenge -->
        <div class="quiz-container">
            <h3 style="color:var(--active); margin-bottom: 20px; font-size: 1.8rem;">
                ğŸ§® ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ (5 Ø£Ø³Ø¦Ù„Ø©)
            </h3>
            
            <div id="quizBox">
                <div class="math-text" id="qDisplay">-- Ã— --</div>
                <input 
                    type="number" 
                    id="qInput" 
                    class="math-input" 
                    placeholder="ØŸ" 
                    onkeypress="if(event.key==='Enter') checkMath()"
                    aria-label="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©"
                >
                <br><br>
                <button 
                    class="btn" 
                    style="background:var(--active); padding: 16px 55px; font-size: 1.3rem;" 
                    onclick="checkMath()"
                >
                    ØªØ­Ù‚Ù‚ âœ…
                </button>
                <div id="feedback" class="feedback-box hidden"></div>
                <p style="margin-top: 20px; color: #666; font-size: 1.05rem;">
                    Ø³Ø¤Ø§Ù„ <span id="qIdx">1</span>/5 | 
                    ØµØ­ÙŠØ­Ø©: <strong style="color: var(--success);" id="correctCount">0</strong> âœ… | 
                    Ø®Ø§Ø·Ø¦Ø©: <strong style="color: var(--error);" id="wrongCount">0</strong> âŒ
                </p>
            </div>
            
            <div id="quizResult" class="hidden" style="padding: 40px;">
                <h2 style="font-size: 2.5rem; margin-bottom: 25px; color: var(--active);">
                    ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ!
                </h2>
                <p style="font-size: 1.8rem; margin: 25px 0; font-weight: 700;">
                    Ø­ØµÙ„Øª Ø¹Ù„Ù‰ <strong style="color: var(--gold);" id="earnedPts">0</strong> Ù†Ù‚Ø·Ø©
                </p>
                <p style="color: #666; margin-bottom: 25px; font-size: 1.2rem;">
                    Ø§Ù„Ù†ØªÙŠØ¬Ø©: <strong id="finalScore">0/5</strong>
                </p>
                <button class="btn" style="background:#444; padding: 14px 40px; font-size: 1.1rem;" onclick="startQuiz()">
                    ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯ ğŸ”„
                </button>
            </div>

            <div id="quizDone" class="hidden" style="padding: 50px 20px;">
                <h2 style="font-size: 2.3rem; color: var(--success); margin-bottom: 20px;">
                    âœ… Ø£Ø­Ø³Ù†Øª! Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…
                </h2>
                <p style="font-size: 1.4rem; color: #666; margin: 25px 0;">
                    Ø¹Ø¯ ØºØ¯Ø§Ù‹ Ù„ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯! ğŸŒŸ
                </p>
                <p style="font-size: 1.2rem; color: var(--active);">
                    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª: <strong id="totalQuizzes">0</strong> ğŸ¯
                </p>
            </div>
        </div>

        <!-- Zoom Classes -->
        <div class="section-header">
            <span class="section-icon">ğŸ“º</span>
            <h2>Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­ØµØµ Ø§Ù„Ø²ÙˆÙˆÙ…</h2>
        </div>
        <div class="zoom-grid" id="zoomArea"></div>

        <!-- School Schedule -->
        <div class="section-header">
            <span class="section-icon">ğŸ«</span>
            <h2>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h2>
        </div>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„ÙŠÙˆÙ…</th>
                        <th>Ø§Ù„Ø­ØµØ© 1</th>
                        <th>Ø§Ù„Ø­ØµØ© 2</th>
                        <th>Ø§Ù„Ø­ØµØ© 3</th>
                        <th>Ø§Ù„Ø­ØµØ© 4</th>
                        <th>Ø§Ù„Ø­ØµØ© 5</th>
                        <th>Ø§Ù„Ø­ØµØ© 6</th>
                        <th>Ø§Ù„Ø­ØµØ© 7</th>
                    </tr>
                </thead>
                <tbody id="schoolBody"></tbody>
            </table>
        </div>

        <!-- Weekly Journal -->
        <div class="section-header">
            <span class="section-icon">ğŸ““</span>
            <h2>Ù…ÙÙƒØ±Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ÙˆØ§Ù„Ù…Ø´Ø§Ø¹Ø±</h2>
        </div>
        <div class="week-picker">
            <button class="week-btn active" onclick="changeWeek(1)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1</button>
            <button class="week-btn" onclick="changeWeek(2)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2</button>
            <button class="week-btn" onclick="changeWeek(3)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3</button>
            <button class="week-btn" onclick="changeWeek(4)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4</button>
        </div>
        <div class="journal-grid" id="journalArea"></div>
    </div>

    <!-- Setup Modal (First Time) -->
    <div id="setupModal" class="modal">
        <div class="modal-content">
            <h3>ğŸš€ Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„!</h3>
            
            <div class="info-box">
                <p>
                    <strong>ğŸ“¦ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†:</strong><br>
                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„Ù†Ù‚Ø§Ø·ØŒ Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª) ØªÙØ­ÙØ¸ ÙÙŠ Ù…Ù„Ù <code>database.json</code> Ø¹Ù„Ù‰ GitHub
                </p>
            </div>

            <h4 style="margin: 25px 0 15px 0; color: var(--active);">ğŸ“ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯:</h4>
            
            <div style="text-align: right; line-height: 2; color: #555; font-size: 0.95rem;">
                <p>1ï¸âƒ£ Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a href="https://github.com" target="_blank" style="color: var(--active);">GitHub.com</a></p>
                <p>2ï¸âƒ£ Ø£Ù†Ø´Ø¦ Ù…Ø³ØªÙˆØ¯Ø¹ Ø¬Ø¯ÙŠØ¯ (Repository)</p>
                <p>3ï¸âƒ£ Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Settings â†’ Developer Settings â†’ Personal Access Tokens â†’ Tokens (classic)</p>
                <p>4ï¸âƒ£ Ø£Ù†Ø´Ø¦ Token Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØµÙ„Ø§Ø­ÙŠØ© <code>repo</code></p>
                <p>5ï¸âƒ£ Ø§Ù†Ø³Ø® Ø§Ù„Ù€ Token ÙˆØ§Ù„ØµÙ‚Ù‡ Ø£Ø¯Ù†Ø§Ù‡</p>
            </div>

            <h4 style="margin: 25px 0 10px 0; color: var(--active);">ğŸ” Ø£Ø¯Ø®Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª GitHub:</h4>
            <input 
                type="password" 
                id="setupToken" 
                class="modal-input" 
                placeholder="GitHub Token (ghp_xxxxxxxxxxxx)"
                aria-label="GitHub Token"
            >
            <input 
                type="text" 
                id="setupRepo" 
                class="modal-input" 
                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (username/repo-name)"
                aria-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹"
            >

            <div class="warning-box">
                <p>
                    âš ï¸ <strong>Ù…Ù‡Ù…:</strong> Ø§Ø­ØªÙØ¸ Ø¨Ù€ Token ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†. Ø³ØªØ­ØªØ§Ø¬Ù‡ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ© Ù…Ù† Ø£Ø¬Ù‡Ø²Ø© Ø£Ø®Ø±Ù‰.
                </p>
            </div>
            
            <button 
                class="btn" 
                style="background: var(--success); color: white; width: 100%; margin-top: 20px; padding: 16px; font-size: 1.2rem;" 
                onclick="saveSetup()"
            >
                Ø­ÙØ¸ ÙˆØ§Ù„Ø¨Ø¯Ø¡ ğŸš€
            </button>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h3>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
            
            <h4 style="margin: 25px 0 15px 0; color: var(--active);">ğŸŒŸ Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§ÙØ¢Øª</h4>
            <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                <button class="btn btn-dahoum" style="flex: 1; padding: 14px;" onclick="addReward('dahoum', 'stars')">
                    Ø¯Ø­ÙˆÙ… +1 â­
                </button>
                <button class="btn btn-remy" style="flex: 1; padding: 14px;" onclick="addReward('remy', 'stars')">
                    Ø±ÙŠÙ…ÙŠ +1 â­
                </button>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn" style="flex: 1; background: linear-gradient(135deg, #f093fb, #f5576c); padding: 14px;" onclick="addReward('dahoum', 'points', 10)">
                    Ø¯Ø­ÙˆÙ… +10 ğŸ¯
                </button>
                <button class="btn" style="flex: 1; background: linear-gradient(135deg, #4facfe, #00f2fe); padding: 14px;" onclick="addReward('remy', 'points', 10)">
                    Ø±ÙŠÙ…ÙŠ +10 ğŸ¯
                </button>
            </div>

            <hr style="margin: 30px 0; border: none; border-top: 2px solid #eee;">

            <h4 style="margin: 20px 0 15px 0; color: var(--active);">â˜ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub</h4>
            <div class="info-box">
                <p>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ù€ GitHub</p>
            </div>
            <input 
                type="password" 
                id="adminToken" 
                class="modal-input" 
                placeholder="GitHub Token"
                aria-label="GitHub Token"
            >
            <input 
                type="text" 
                id="adminRepo" 
                class="modal-input" 
                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (username/repo)"
                aria-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹"
            >
            
            <button 
                class="btn" 
                style="background: var(--success); color: white; width: 100%; margin-top: 20px; padding: 15px; font-size: 1.1rem;" 
                onclick="updateGitHubSettings()"
            >
                ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆÙ…Ø²Ø§Ù…Ù†Ø© ğŸ”„
            </button>

            <button 
                class="btn" 
                style="background: #2196F3; color: white; width: 100%; margin-top: 12px; padding: 15px; font-size: 1.1rem;" 
                onclick="forceSyncNow()"
            >
                Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ø§Ù„Ø¢Ù† âš¡
            </button>
            
            <button 
                class="btn" 
                style="background: #eee; color: #333; width: 100%; margin-top: 12px; padding: 15px;" 
                onclick="closeAdmin()"
            >
                Ø¥ØºÙ„Ø§Ù‚ âœ–ï¸
            </button>
        </div>
    </div>

<script>
    'use strict';

    // ==========================================
    // Configuration & Constants
    // ==========================================
    
    const DAYS = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³"];
    
    const BADGES = [
        { emoji: 'ğŸŒŸ', name: '10 Ù†Ø¬ÙˆÙ…', req: 10, type: 'stars' },
        { emoji: 'â­', name: '25 Ù†Ø¬Ù…Ø©', req: 25, type: 'stars' },
        { emoji: 'ğŸ†', name: '50 Ù†Ø¬Ù…Ø©', req: 50, type: 'stars' },
        { emoji: 'ğŸ¯', name: '100 Ù†Ù‚Ø·Ø©', req: 100, type: 'points' },
        { emoji: 'ğŸ–ï¸', name: '500 Ù†Ù‚Ø·Ø©', req: 500, type: 'points' },
        { emoji: 'ğŸ§®', name: '10 ØªØ­Ø¯ÙŠØ§Øª', req: 10, type: 'quizzes' }
    ];

    const CONFIG = {
        dahoum: {
            theme: "dahoum-theme",
            welcome: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø§Ù„Ø¨Ø·Ù„ Ø¯Ø­ÙˆÙ…!",
            placeholder: "https://via.placeholder.com/150/0077b6/ffffff?text=ğŸ‘¦",
            zoom: [
                { t: "Ù‚Ø±Ø¢Ù† (Ø£. Ù‡Ø§Ø¬Ø±)", d: "Ø£Ø­Ø¯ØŒ Ø§Ø«Ù†ÙŠÙ†ØŒ Ø£Ø±Ø¨Ø¹Ø§Ø¡", h: "2:30 Ø¸", l: "https://us05web.zoom.us/j/5552102339?pwd=7fPtK8N4zIBbY8fvreFOdeqxmP4AJL.1" },
                { t: "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ø£. Ù…Ù†Ø§Ø±)", d: "Ø£Ø­Ø¯ØŒ Ø«Ù„Ø§Ø«Ø§Ø¡", h: "6:00 Ù…", l: "https://us05web.zoom.us/j/89914760138?pwd=GH8Uoy2ew11eBgj3YUYLTSjzUCwb9j.1" }
            ],
            school: [
                ["Ù‚Ø±Ø¢Ù†", "Ø¨Ø¯Ù†ÙŠØ©", "Ø­ÙŠØ§ØªÙŠØ©", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¹Ù„ÙˆÙ…", "ÙÙ†ÙŠØ©", "Ø¹Ø±Ø¨ÙŠ"],
                ["Ø¹Ù„ÙˆÙ…", "Ø¨Ø¯Ù†ÙŠØ©", "Ù‚Ø±Ø¢Ù†", "Ø¹Ø±Ø¨ÙŠ", "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¹Ø±Ø¨ÙŠ"],
                ["Ø¹Ù„ÙˆÙ…", "Ø¨Ø¯Ù†ÙŠØ©", "Ù‚Ø±Ø¢Ù†", "Ø¹Ø±Ø¨ÙŠ", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ù†Ø´Ø§Ø·", "-"],
                ["Ù‚Ø±Ø¢Ù†", "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¹Ø±Ø¨ÙŠ", "Ø¹Ù„ÙˆÙ…", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "-"],
                ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ø¹Ø±Ø¨ÙŠ", "Ù‚Ø±Ø¢Ù†", "ÙÙ†ÙŠØ©", "Ù†Ø´Ø§Ø·", "-"]
            ]
        },
        remy: {
            theme: "remy-theme",
            welcome: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø§Ù„Ù…Ø¨Ø¯Ø¹Ø© Ø±ÙŠÙ…ÙŠ!",
            placeholder: "https://via.placeholder.com/150/6a1b9a/ffffff?text=ğŸ‘§",
            zoom: [
                { t: "Ù‚Ø±Ø¢Ù† (Ø£. Ù…Ù†Ù‡)", d: "Ø£Ø­Ø¯ØŒ Ø«Ù„Ø§Ø«Ø§Ø¡ØŒ Ø£Ø±Ø¨Ø¹Ø§Ø¡", h: "2:00 Ø¸", l: "https://us05web.zoom.us/j/4365062686?pwd=gzEitR0Y0KKyh5xukgAZwrqNXdibWx.1" },
                { t: "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ø£. Ù…Ù†Ø§Ø±)", d: "Ø£Ø­Ø¯ØŒ Ø«Ù„Ø§Ø«Ø§Ø¡", h: "6:00 Ù…", l: "https://us05web.zoom.us/j/89914760138?pwd=GH8Uoy2ew11eBgj3YUYLTSjzUCwb9j.1" }
            ],
            school: [
                ["Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ù„ØºØªÙŠ", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ù„ØºØªÙŠ", "Ø¨Ø¯Ù†ÙŠØ©", "Ù†Ø´Ø§Ø· 3"],
                ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ù„ØºØªÙŠ", "Ø­ÙŠØ§ØªÙŠØ©", "Ù†Ø´Ø§Ø· 3", "Ø¨Ø¯Ù†ÙŠØ©", "Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ø¹Ù„ÙˆÙ…"],
                ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ù„ØºØªÙŠ", "Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ù†Ø´Ø§Ø· 3", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "ÙÙ†ÙŠØ©", "ÙÙ†ÙŠØ©"],
                ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¹Ù„ÙˆÙ…", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¹Ù„ÙˆÙ…", "Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ù„ØºØªÙŠ", "-"],
                ["Ù„ØºØªÙŠ", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ø¨Ø¯Ù†ÙŠØ©", "Ø¹Ù„ÙˆÙ…", "-"]
            ]
        }
    };

    // ==========================================
    // State Variables
    // ==========================================
    
    let currentUser = 'dahoum';
    let currentWeek = 1;
    let qIdx = 1;
    let currentAns = 0;
    let currentScore = 0;
    let correctAnswers = 0;
    let wrongAnswers = 0;
    let syncTimer = null;
    let appData = {}; // Main data store (loaded from GitHub)
    let githubToken = '';
    let githubRepo = '';

    // ==========================================
    // Initialization
    // ==========================================
    
    window.onload = async () => {
        await initializeApp();
    };

    async function initializeApp() {
        try {
            showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
            
            // Check if GitHub is configured
            githubToken = localStorage.getItem('gh_token') || '';
            githubRepo = localStorage.getItem('gh_repo') || '';
            
            if (!githubToken || !githubRepo) {
                // First time setup
                hideLoading();
                openSetup();
                return;
            }
            
            // Load data from GitHub
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub...');
            await loadFromGitHub();
            
            // Initialize UI
            hideLoading();
            switchUser('dahoum');
            
            // Hide setup button if configured
            document.getElementById('setupBtn').classList.add('hidden');
            
        } catch (error) {
            console.error('Initialization error:', error);
            showLoadingError('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub.');
        }
    }

    // ==========================================
    // GitHub Data Management
    // ==========================================
    
    /**
     * Load data from GitHub
     */
    async function loadFromGitHub() {
        const url = `https://api.github.com/repos/${githubRepo}/contents/database.json`;
        
        try {
            const response = await fetch(url, {
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            if (response.ok) {
                const json = await response.json();
                const content = decodeURIComponent(escape(atob(json.content)));
                appData = JSON.parse(content);
                
                showStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success', 2000);
            } else if (response.status === 404) {
                // File doesn't exist, create initial data
                appData = createInitialData();
                await saveToGitHub('Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠ');
                showStatus('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…', 'success', 2000);
            } else {
                throw new Error(`GitHub API error: ${response.status}`);
            }
        } catch (error) {
            console.error('Load error:', error);
            // Use empty data if load fails
            appData = createInitialData();
            throw error;
        }
    }

    /**
     * Save data to GitHub
     */
    async function saveToGitHub(commitMessage = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª') {
        const url = `https://api.github.com/repos/${githubRepo}/contents/database.json`;
        
        showStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...', 'syncing');
        
        try {
            // Get current file SHA
            let sha = '';
            try {
                const getResponse = await fetch(url, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (getResponse.ok) {
                    const json = await getResponse.json();
                    sha = json.sha;
                }
            } catch (e) {
                // File doesn't exist yet
            }
            
            // Prepare content
            const content = JSON.stringify(appData, null, 2);
            const encodedContent = btoa(unescape(encodeURIComponent(content)));
            
            // Upload to GitHub
            const putResponse = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `${commitMessage} - ${new Date().toLocaleString('ar-SA')}`,
                    content: encodedContent,
                    sha: sha
                })
            });
            
            if (putResponse.ok) {
                showStatus('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success', 2000);
                return true;
            } else {
                const error = await putResponse.json();
                throw new Error(error.message || 'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸');
            }
        } catch (error) {
            console.error('Save error:', error);
            showStatus('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ âŒ', 'error', 3000);
            return false;
        }
    }

    /**
     * Create initial data structure
     */
    function createInitialData() {
        const data = {};
        
        ['dahoum', 'remy'].forEach(user => {
            data[`${user}_stars`] = 0;
            data[`${user}_points`] = 0;
            data[`${user}_quizzes`] = 0;
            data[`${user}_perfects`] = 0;
            data[`${user}_lastQuiz`] = '';
            data[`${user}_img`] = '';
            
            // Initialize weekly journals
            for (let week = 1; week <= 4; week++) {
                DAYS.forEach(day => {
                    data[`${user}_w${week}_${day}`] = JSON.stringify({
                        hw: '',
                        h1: '',
                        h2: '',
                        sad: ''
                    });
                });
            }
        });
        
        return data;
    }

    /**
     * Get value from appData
     */
    function getData(key, defaultValue = '') {
        return appData[key] !== undefined ? appData[key] : defaultValue;
    }

    /**
     * Set value in appData
     */
    function setData(key, value) {
        appData[key] = value;
    }

    /**
     * Debounced save to GitHub
     */
    function scheduleSave(commitMessage = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª') {
        if (syncTimer) clearTimeout(syncTimer);
        
        syncTimer = setTimeout(() => {
            saveToGitHub(commitMessage);
        }, 2000); // Save after 2 seconds of inactivity
    }

    // ==========================================
    // UI Helper Functions
    // ==========================================
    
    function showLoading(message) {
        document.getElementById('loadingText').innerText = message;
        document.getElementById('loadingScreen').classList.remove('hidden');
    }

    function hideLoading() {
        document.getElementById('loadingScreen').classList.add('hidden');
    }

    function showLoadingError(message) {
        const loadingScreen = document.getElementById('loadingScreen');
        loadingScreen.innerHTML = `
            <div class="loading-error">
                <h3>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£</h3>
                <p>${message}</p>
                <button class="btn" style="background: var(--active); margin-top: 15px;" onclick="location.reload()">
                    Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ğŸ”„
                </button>
                <button class="btn" style="background: var(--warning); margin-top: 10px;" onclick="resetSetup()">
                    Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ âš™ï¸
                </button>
            </div>
        `;
    }

    function showStatus(message, type = 'syncing', duration = 0) {
        const status = document.getElementById('syncStatus');
        const icon = document.getElementById('syncIcon');
        const text = document.getElementById('syncText');
        
        const icons = {
            syncing: 'â˜ï¸',
            success: 'âœ…',
            error: 'âŒ'
        };
        
        icon.innerText = icons[type] || 'â˜ï¸';
        text.innerText = message;
        status.className = `sync-status ${type} show`;
        
        if (duration > 0) {
            setTimeout(() => {
                status.classList.remove('show');
            }, duration);
        }
    }

    function resetSetup() {
        localStorage.removeItem('gh_token');
        localStorage.removeItem('gh_repo');
        location.reload();
    }

    // ==========================================
    // User Interface Functions
    // ==========================================
    
    function switchUser(u) {
        currentUser = u;
        const c = CONFIG[u];
        
        // Update theme
        document.getElementById('appBody').className = c.theme;
        document.getElementById('uWelcome').innerText = c.welcome;
        
        // Update stats
        updateStats();
        
        // Update profile image
        const savedImg = getData(`${u}_img`, c.placeholder);
        document.getElementById('uImg').src = savedImg || c.placeholder;
        
        // Render components
        renderBadges();
        renderZoom();
        renderSchool();
        renderJournal();
        checkQuizStatus();
    }

    function updateStats() {
        const stars = parseInt(getData(`${currentUser}_stars`, '0'));
        const points = parseInt(getData(`${currentUser}_points`, '0'));
        const level = Math.floor(points / 100) + 1;
        
        document.getElementById('uStars').innerText = stars;
        document.getElementById('uPts').innerText = points;
        document.getElementById('uLvl').innerText = level;
    }

    function renderBadges() {
        const stars = parseInt(getData(`${currentUser}_stars`, '0'));
        const points = parseInt(getData(`${currentUser}_points`, '0'));
        const quizzes = parseInt(getData(`${currentUser}_quizzes`, '0'));
        
        const stats = { stars, points, quizzes };
        
        const html = BADGES.map(badge => {
            const earned = stats[badge.type] >= badge.req;
            return `
                <div class="badge ${earned ? 'earned' : 'locked'}" title="${badge.name}">
                    ${badge.emoji}
                </div>
            `;
        }).join('');
        
        document.getElementById('badgesArea').innerHTML = html;
    }

    function renderZoom() {
        const html = CONFIG[currentUser].zoom.map(z => `
            <div class="zoom-card">
                <strong>${z.t}</strong>
                <small style="display: block; margin: 8px 0; color: #666;">ğŸ“… ${z.d}</small>
                <small style="display: block; color: #666;">â° ${z.h}</small>
                <a href="${z.l}" target="_blank" class="zoom-btn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­ØµØ© ğŸ–¥ï¸</a>
            </div>
        `).join('');
        
        document.getElementById('zoomArea').innerHTML = html;
    }

    function renderSchool() {
        const html = DAYS.map((d, i) => `
            <tr>
                <td class="day-cell">${d}</td>
                ${CONFIG[currentUser].school[i].map(c => `<td>${c}</td>`).join('')}
            </tr>
        `).join('');
        
        document.getElementById('schoolBody').innerHTML = html;
    }

    function changeWeek(w) {
        currentWeek = w;
        
        document.querySelectorAll('.week-btn').forEach((b, i) => {
            b.classList.toggle('active', i + 1 === w);
        });
        
        renderJournal();
    }

    function renderJournal() {
        const html = DAYS.map(d => {
            const key = `${currentUser}_w${currentWeek}_${d}`;
            const data = JSON.parse(getData(key, '{"hw":"","h1":"","h2":"","sad":""}'));
            
            return `
                <div class="day-card">
                    <h3>ğŸ“… ${d}</h3>
                    <label>ğŸ“ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª:</label>
                    <textarea 
                        onchange="saveNote('${key}','hw',this.value)" 
                        placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¬Ø¨Ø§ØªÙƒ Ù‡Ù†Ø§..."
                        aria-label="ÙˆØ§Ø¬Ø¨Ø§Øª ÙŠÙˆÙ… ${d}"
                    >${data.hw || ''}</textarea>
                    
                    <label style="color: var(--success);">ğŸ˜Š Ø£Ø´ÙŠØ§Ø¡ Ø³Ø¹ÙŠØ¯Ø©:</label>
                    <textarea 
                        onchange="saveNote('${key}','h1',this.value)" 
                        placeholder="Ø­Ø¯Ø« Ø³Ø¹ÙŠØ¯ 1"
                        aria-label="Ø­Ø¯Ø« Ø³Ø¹ÙŠØ¯ 1 ÙŠÙˆÙ… ${d}"
                    >${data.h1 || ''}</textarea>
                    <textarea 
                        onchange="saveNote('${key}','h2',this.value)" 
                        placeholder="Ø­Ø¯Ø« Ø³Ø¹ÙŠØ¯ 2"
                        aria-label="Ø­Ø¯Ø« Ø³Ø¹ÙŠØ¯ 2 ÙŠÙˆÙ… ${d}"
                    >${data.h2 || ''}</textarea>
                    
                    <label style="color: var(--error);">ğŸ˜” Ø´ÙŠØ¡ Ø£Ø²Ø¹Ø¬Ù†ÙŠ:</label>
                    <textarea 
                        onchange="saveNote('${key}','sad',this.value)" 
                        placeholder="Ø§ÙƒØªØ¨ Ù…Ø§ Ø£Ø²Ø¹Ø¬Ùƒ..."
                        aria-label="Ø´ÙŠØ¡ Ù…Ø­Ø²Ù† ÙŠÙˆÙ… ${d}"
                    >${data.sad || ''}</textarea>
                </div>
            `;
        }).join('');
        
        document.getElementById('journalArea').innerHTML = html;
    }

    function saveNote(key, field, value) {
        const data = JSON.parse(getData(key, '{}'));
        data[field] = value;
        setData(key, JSON.stringify(data));
        
        scheduleSave('ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª');
    }

    // ==========================================
    // Math Quiz Functions
    // ==========================================
    
    function checkQuizStatus() {
        const today = new Date().toDateString();
        const lastQuiz = getData(`${currentUser}_lastQuiz`, '');
        const quizzes = parseInt(getData(`${currentUser}_quizzes`, '0'));
        
        if (lastQuiz === today) {
            document.getElementById('quizBox').classList.add('hidden');
            document.getElementById('quizResult').classList.add('hidden');
            document.getElementById('quizDone').classList.remove('hidden');
            document.getElementById('totalQuizzes').innerText = quizzes;
        } else {
            document.getElementById('quizDone').classList.add('hidden');
            startQuiz();
        }
    }

    function startQuiz() {
        qIdx = 1;
        currentScore = 0;
        correctAnswers = 0;
        wrongAnswers = 0;
        
        document.getElementById('quizBox').classList.remove('hidden');
        document.getElementById('quizResult').classList.add('hidden');
        document.getElementById('quizDone').classList.add('hidden');
        
        updateQuizCounters();
        genQ();
    }

    function genQ() {
        const isDiv = Math.random() > 0.5;
        
        if (isDiv) {
            const divisor = Math.floor(Math.random() * 10) + 1;
            const result = Math.floor(Math.random() * 10) + 1;
            const dividend = result * divisor;
            
            document.getElementById('qDisplay').innerText = `${dividend} Ã· ${divisor}`;
            currentAns = result;
        } else {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            
            document.getElementById('qDisplay').innerText = `${num1} Ã— ${num2}`;
            currentAns = num1 * num2;
        }
        
        document.getElementById('qIdx').innerText = qIdx;
        document.getElementById('qInput').value = '';
        document.getElementById('qInput').focus();
        document.getElementById('feedback').classList.add('hidden');
    }

    function checkMath() {
        const val = parseInt(document.getElementById('qInput').value);
        const fb = document.getElementById('feedback');
        
        if (isNaN(val)) {
            fb.innerText = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…!";
            fb.className = "feedback-box wrong";
            fb.classList.remove('hidden');
            return;
        }
        
        fb.classList.remove('hidden');
        
        if (val === currentAns) {
            correctAnswers++;
            currentScore += 20;
            fb.innerText = "ğŸ‰ ØµØ­! Ø¨Ø·Ù„ +20 Ù†Ù‚Ø·Ø©";
            fb.className = "feedback-box correct";
        } else {
            wrongAnswers++;
            fb.innerHTML = `âŒ Ø®Ø·Ø£! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <b>${currentAns}</b>`;
            fb.className = "feedback-box wrong";
        }
        
        updateQuizCounters();
        
        setTimeout(() => {
            if (qIdx < 5) {
                qIdx++;
                genQ();
            } else {
                finishQuiz();
            }
        }, 2000);
    }

    function updateQuizCounters() {
        document.getElementById('correctCount').innerText = correctAnswers;
        document.getElementById('wrongCount').innerText = wrongAnswers;
    }

    function finishQuiz() {
        document.getElementById('quizBox').classList.add('hidden');
        document.getElementById('quizResult').classList.remove('hidden');
        document.getElementById('earnedPts').innerText = currentScore;
        document.getElementById('finalScore').innerText = `${correctAnswers}/5`;
        
        // Update points
        const currentPts = parseInt(getData(`${currentUser}_points`, '0'));
        setData(`${currentUser}_points`, currentPts + currentScore);
        
        // Update quiz count
        const currentQuizzes = parseInt(getData(`${currentUser}_quizzes`, '0'));
        setData(`${currentUser}_quizzes`, currentQuizzes + 1);
        
        // Update perfects if all correct
        if (correctAnswers === 5) {
            const perfects = parseInt(getData(`${currentUser}_perfects`, '0'));
            setData(`${currentUser}_perfects`, perfects + 1);
        }
        
        // Save completion date
        const today = new Date().toDateString();
        setData(`${currentUser}_lastQuiz`, today);
        
        // Update UI
        updateStats();
        renderBadges();
        
        // Save to GitHub
        saveToGitHub('Ø¥ÙƒÙ…Ø§Ù„ ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª');
    }

    // ==========================================
    // Image Upload
    // ==========================================
    
    async function uploadImg(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // Validate
        if (!file.type.startsWith('image/')) {
            alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ÙÙ‚Ø·');
            return;
        }
        
        if (file.size > 5 * 1024 * 1024) {
            alert('âš ï¸ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB');
            return;
        }
        
        try {
            showStatus('Ø¬Ø§Ø±ÙŠ Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø©...', 'syncing');
            
            // Compress and convert to base64
            const compressed = await compressImage(file, 600, 0.8);
            
            // Update UI
            document.getElementById('uImg').src = compressed;
            
            // Save to data
            setData(`${currentUser}_img`, compressed);
            
            // Save to GitHub
            await saveToGitHub('ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©');
            
        } catch (error) {
            console.error('Upload error:', error);
            alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©');
        }
    }

    /**
     * Compress image before saving
     */
    function compressImage(file, maxWidth, quality) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = (e) => {
                const img = new Image();
                
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height) {
                        if (width > maxWidth) {
                            height *= maxWidth / width;
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxWidth) {
                            width *= maxWidth / height;
                            height = maxWidth;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                
                img.onerror = () => reject(new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©'));
                img.src = e.target.result;
            };
            
            reader.onerror = () => reject(new Error('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
            reader.readAsDataURL(file);
        });
    }

    // ==========================================
    // Modal Functions
    // ==========================================
    
    function openSetup() {
        document.getElementById('setupModal').classList.add('active');
        document.getElementById('setupToken').value = githubToken;
        document.getElementById('setupRepo').value = githubRepo;
    }

    async function saveSetup() {
        const token = document.getElementById('setupToken').value.trim();
        const repo = document.getElementById('setupRepo').value.trim();
        
        if (!token || !repo) {
            alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!');
            return;
        }
        
        if (!repo.includes('/')) {
            alert('âš ï¸ ØµÙŠØºØ© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ØºÙŠØ± ØµØ­ÙŠØ­Ø©! Ù…Ø«Ø§Ù„: username/repo-name');
            return;
        }
        
        // Save credentials
        localStorage.setItem('gh_token', token);
        localStorage.setItem('gh_repo', repo);
        githubToken = token;
        githubRepo = repo;
        
        // Close modal and reload
        document.getElementById('setupModal').classList.remove('active');
        location.reload();
    }

    function openAdmin() {
        const password = prompt("ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        
        if (password === null) return;
        
        if (password === "123456") {
            document.getElementById('adminModal').classList.add('active');
            document.getElementById('adminToken').value = githubToken;
            document.getElementById('adminRepo').value = githubRepo;
        } else {
            alert("âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
        }
    }

    function closeAdmin() {
        document.getElementById('adminModal').classList.remove('active');
    }

    function addReward(user, type, amount = 1) {
        const key = type === 'stars' ? `${user}_stars` : `${user}_points`;
        const current = parseInt(getData(key, '0'));
        setData(key, current + amount);
        
        if (user === currentUser) {
            updateStats();
            renderBadges();
        }
        
        const label = type === 'stars' ? 'Ù†Ø¬Ù…Ø©' : 'Ù†Ù‚Ø·Ø©';
        const userName = user === 'dahoum' ? 'Ø¯Ø­ÙˆÙ…' : 'Ø±ÙŠÙ…ÙŠ';
        
        saveToGitHub(`Ø¥Ø¶Ø§ÙØ© ${amount} ${label} Ù„Ù€ ${userName}`);
        alert(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${amount} ${label} Ù„Ù€ ${userName}!`);
    }

    async function updateGitHubSettings() {
        const token = document.getElementById('adminToken').value.trim();
        const repo = document.getElementById('adminRepo').value.trim();
        
        if (!token || !repo) {
            alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!');
            return;
        }
        
        if (!repo.includes('/')) {
            alert('âš ï¸ ØµÙŠØºØ© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
            return;
        }
        
        localStorage.setItem('gh_token', token);
        localStorage.setItem('gh_repo', repo);
        githubToken = token;
        githubRepo = repo;
        
        await saveToGitHub('ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub');
        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª!');
    }

    async function forceSyncNow() {
        await saveToGitHub('Ù…Ø²Ø§Ù…Ù†Ø© ÙŠØ¯ÙˆÙŠØ©');
    }

    // Close modals on outside click
    document.getElementById('adminModal').addEventListener('click', function(e) {
        if (e.target === this) closeAdmin();
    });
</script>

</body>
</html>
